---
layout: post
title: 批处理程序实现文件跨机拷贝
categories: programming
tags: [批处理, copy, 同步]
---

前些日子，我实习的公司需要实现一个服务器双机文件同步的功能，大家都忙着其他事情，秉着多学点东西的心态，就接下了这个活。
公司服务器进行了双机负载均衡，某些文件将平均的分布在两台服务器上，但程序读取这些文件的时候又希望只固定读取一台服务器
上的文件，为此需要将一台服务器上的文件合并到另一台服务器。由于两台服务器使用Windows系统，使用批处理程序跨机拷贝文件的
方式，并且为其配置Job定期运行，实现双机实现文件同步功能。

### 功能详述

编写windows批处理（bat）程序, 实现如下功能:  
1. 定时将服务器A的`c:\project\yyyymmdd`下所有的xml文件同步到服务器B对应目录  
2. 遇到重名的情况，需要对重名的xml文件进行比较，保留较新的一个xml文件  
3. 用job运行此bat程序，间隔为一分钟一次

###实现程序
程序file_copy.bat
    @echo off

    rem 8个参数
    rem 1.目的IP地址
    rem 2.目的机登录密码
    rem 3.目的机用户名
    rem 4.源文件1
    rem 5.源文件2
    rem 6.目的驱动器
    rem 7.目的路径（不含驱动器）
    rem 8.目的路径2（不含驱动器

    net use \\%1\ipc$ %2 /user:%3
    xcopy %4 \\%1\%6$\%7 /s /e /y /c /k /d
    xcopy %5 \\%1\%6$\%8 /s /e /y /c /k /d
    net use \\%1\ipc$ /delete
